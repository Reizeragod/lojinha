<script>
document.addEventListener('DOMContentLoaded', () => {
  const CART_KEY = 'stylehub_cart';
  let cart = JSON.parse(localStorage.getItem(CART_KEY)) || [];

  const carrinhoContador = document.getElementById('carrinhoContador');
  const cartCountSummary = document.getElementById('cartCountSummary');
  const checkoutContainer = document.querySelector('.row.g-5');
  const btnPagar = document.getElementById('btnPagar');

  function formatPrice(v) {
    return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  }

  function updateCartCounters() {
    const totalQty = cart.reduce((sum, item) => sum + item.quantity, 0);
    if (carrinhoContador) carrinhoContador.textContent = totalQty;
    if (cartCountSummary) cartCountSummary.textContent = totalQty;
  }

  function renderCartSummary() {
    const cartList = document.querySelector('.list-group.mb-3');
    if (!cartList) return;

    cartList.innerHTML = '';
    if (cart.length === 0) {
      checkoutContainer.innerHTML = `
        <div class="col-12 text-center py-5">
          <i class="fas fa-shopping-bag fa-5x mb-4 text-muted"></i>
          <h2 class="mb-3">Seu carrinho est√° vazio!</h2>
          <p class="lead">Volte para as <a href="colecoes.html">Cole√ß√µes</a> e escolha algo!</p>
        </div>
      `;
      return;
    }

    let total = 0;
    cart.forEach(item => {
      total += item.price * item.quantity;
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between lh-sm';
      li.innerHTML = `
        <div>
          <h6 class="my-0">${item.name}</h6>
          <small class="text-muted">Qtd: ${item.quantity}</small>
        </div>
        <span class="text-muted">${formatPrice(item.price * item.quantity)}</span>
      `;
      cartList.appendChild(li);
    });

    const desconto = total * 0.1;
    const totalComDesconto = total - desconto;

    const descontoLi = `
      <li class="list-group-item d-flex justify-content-between bg-light">
        <div class="text-success">
          <h6 class="my-0">C√≥digo Promocional</h6>
          <small>PRIMEIRACOMPRA</small>
        </div>
        <span class="text-success">‚àí${formatPrice(desconto)}</span>
      </li>
      <li class="list-group-item d-flex justify-content-between">
        <span>Total (BRL)</span>
        <strong>${formatPrice(totalComDesconto)}</strong>
      </li>
    `;
    cartList.insertAdjacentHTML('beforeend', descontoLi);

    btnPagar.innerHTML = `<i class="fas fa-lock me-2"></i> Pagar Agora (${formatPrice(totalComDesconto)})`;

    btnPagar.addEventListener('click', e => {
      e.preventDefault();
      alert(`ü•≥ Sucesso! Seu pagamento de ${formatPrice(totalComDesconto)} foi processado.`);
      localStorage.removeItem(CART_KEY);
      setTimeout(() => (window.location.href = "index.html"), 2000);
    });
  }

  updateCartCounters();
  renderCartSummary();
});
</script>
